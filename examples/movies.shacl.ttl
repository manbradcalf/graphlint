@prefix ex:   <http://example.org/movies#> .
@prefix sh:   <http://www.w3.org/ns/shacl#> .
@prefix xsd:  <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .

# ── Movie ────────────────────────────────────────────────────────────

ex:MovieShape
    a sh:NodeShape ;
    sh:targetClass ex:Movie ;

    sh:property [
        sh:path     ex:title ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
    ] ;

    sh:property [
        sh:path     ex:released ;
        sh:datatype xsd:integer ;
        sh:minCount 1 ;
        sh:minInclusive 1888 ;
        sh:maxInclusive 2100 ;
    ] ;

    sh:property [
        sh:path     ex:tagline ;
        sh:datatype xsd:string ;
        sh:maxLength 500 ;
    ] ;

    sh:property [
        sh:path          ex:announcedYear ;
        sh:datatype      xsd:integer ;
        sh:lessThan      ex:released ;
    ] ;

    sh:not [
        sh:property [
            sh:path     ex:tagline ;
            sh:hasValue "TBD" ;
        ] ;
    ] ;

    sh:property [
        sh:path     ex:hasActor ;
        sh:nodeKind sh:IRI ;
        sh:node     ex:PersonShape ;
        sh:minCount 1 ;
    ] ;

    sh:property [
        sh:path     ex:hasDirector ;
        sh:nodeKind sh:IRI ;
        sh:node     ex:PersonShape ;
        sh:minCount 1 ;
    ] ;

    sh:property [
        sh:path     ex:inGenre ;
        sh:nodeKind sh:IRI ;
        sh:node     ex:GenreShape ;
        sh:minCount 1 ;
    ] ;

    sh:property [
        sh:path     ex:rating ;
        sh:in       ( "G" "PG" "PG-13" "R" "NC-17" ) ;
    ] .

# ── Person ───────────────────────────────────────────────────────────

ex:PersonShape
    a sh:NodeShape ;
    sh:targetClass ex:Person ;

    sh:property [
        sh:path     ex:name ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
        sh:minLength 2 ;
    ] ;

    sh:property [
        sh:path     ex:born ;
        sh:datatype xsd:integer ;
    ] ;

    sh:property [
        sh:path     ex:nationality ;
        sh:datatype xsd:string ;
    ] ;

    sh:property [
        sh:path     [ sh:inversePath ex:hasActor ] ;
        sh:nodeKind sh:IRI ;
        sh:node     ex:MovieShape ;
    ] ;

    sh:or (
        [ sh:property [ sh:path ex:born ; sh:minCount 1 ] ]
        [ sh:property [ sh:path ex:nationality ; sh:minCount 1 ] ]
    ) .

# ── Genre ────────────────────────────────────────────────────────────

ex:GenreShape
    a sh:NodeShape ;
    sh:targetClass ex:Genre ;
    sh:closed true ;
    sh:ignoredProperties ( ex:internalId ) ;

    sh:property [
        sh:path     ex:name ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
    ] .

# ── Review ───────────────────────────────────────────────────────────

ex:ReviewShape
    a sh:NodeShape ;
    sh:targetClass ex:Review ;

    sh:property [
        sh:path         ex:score ;
        sh:datatype     xsd:float ;
        sh:minCount     1 ;
        sh:minExclusive 0.0 ;
        sh:maxExclusive 10.0 ;
    ] ;

    sh:property [
        sh:path     ex:summary ;
        sh:datatype xsd:string ;
        sh:minCount 1 ;
    ] ;

    sh:property [
        sh:path     ex:reviewOf ;
        sh:nodeKind sh:IRI ;
        sh:node     ex:MovieShape ;
        sh:minCount 1 ;
        sh:maxCount 1 ;
    ] ;

    sh:property [
        sh:path     ex:writtenBy ;
        sh:nodeKind sh:IRI ;
        sh:node     ex:PersonShape ;
        sh:maxCount 1 ;
    ] .
